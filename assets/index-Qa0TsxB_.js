(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const m=(t,e)=>{localStorage.setItem(t,JSON.stringify(e))},l=t=>localStorage.getItem(t)!==null?JSON.parse(localStorage.getItem(t)):[],f="https://api.jikan.moe/v4/anime",v=async t=>{try{const e=await fetch(`${f}?q=${t}`,{method:"GET",headers:{"Content-Type":"application/json"},redirect:"follow"});if(e.ok)return e.json();throw e}catch(e){throw console.log(e),e instanceof Response?{status:e.status,message:e.statusText}:e}},h=t=>l("animes").find(n=>n.title===t),a=document.querySelector("#search__input"),i=document.querySelector(".suggest"),L=document.querySelector(".output"),d=document.querySelector(".last-searches"),y=t=>{if(i.classList.remove("active"),t.length){const e=l("visited");let o=0;t.map(n=>n.title).slice(0,10).forEach(n=>{const s=document.createElement("div");s.classList.add("suggest__item"),s.classList.add("suggest__item_anime"),s.textContent=n,e.find(r=>r.title===n)&&o<5?(o+=1,s.classList.add("suggest__item_visited"),i.prepend(s)):i.append(s)}),i.classList.add("active")}else{const e=document.createElement("div");e.classList.add("suggest__item"),e.textContent="There is no valid search results",i.append(e),i.classList.add("active")}},_=t=>{const e=document.querySelector(".output__header"),o=document.querySelector(".output__poster .poster-logo"),n=document.querySelector(".genres-text"),s=document.querySelector(".synopsys-text"),r=document.querySelector(".score-text"),c=document.querySelector(".url-text a");e.textContent=t.title,o.setAttribute("src",t.images.webp.image_url),n.textContent=t.genres.map(p=>p.name).join(", "),s.textContent=t.synopsis?t.synopsis:"Check MAL",r.textContent=t.score?`${t.score}`:"Not enough rates",c.setAttribute("href",t.url),L.classList.add("show")},g=()=>{d.innerHTML="";const t=document.createElement("h2");t.classList.add("last-searches__header"),t.textContent="Последние запросы:";const e=document.createElement("div");e.classList.add("last-searches__content"),d.append(t,e),l("visited").slice(0,3).forEach(n=>{const s=document.createElement("div");s.classList.add("last-searches__item"),s.textContent=n.title,e.append(s)}),d.classList.add("show")};let u;a.addEventListener("input",t=>{t.preventDefault(),a.value?(clearTimeout(u),u=setTimeout(async()=>{i.innerHTML="",i.classList.remove("active");let e=[];try{const o=await v(a.value);console.log(o),e=o.data,m("animes",e),y(e)}catch(o){console.log(o);const n=document.createElement("div");n.classList.add("suggest__item"),typeof o=="object"&&o!==null&&"status"in o&&"message"in o?n.textContent=`Error ${o.status}. 
            ${o.message}`:n.textContent=`${o}`,i.append(n),i.classList.add("active")}},300)):(i.innerHTML="",i.classList.remove("active"))});i.addEventListener("click",t=>{if(t.target instanceof HTMLDivElement&&t.target.classList.contains("suggest__item_anime")){a.value="",i.classList.remove("active");const e=t.target.textContent,o=h(e),n=l("visited");n.find(s=>s.title===e)||n.unshift(o),m("visited",n),_(o),g()}});window.addEventListener("storage",()=>{g()});

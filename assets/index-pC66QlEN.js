(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();const m=(s,e)=>{localStorage.setItem(s,JSON.stringify(e))},l=s=>localStorage.getItem(s)!==null?JSON.parse(localStorage.getItem(s)):[],f="https://api.jikan.moe/v4/anime",v=async s=>{try{const e=await fetch(`${f}?q=${s}`,{method:"GET",headers:{"Content-Type":"application/json"},redirect:"follow"});if(e.ok)return e.json();throw e}catch(e){throw console.log(e),e instanceof Response?{status:e.status,message:e.statusText}:e}},h=s=>l("animes").find(o=>o.title===s),a=document.querySelector("#search__input"),i=document.querySelector(".suggest"),L=document.querySelector(".output"),d=document.querySelector(".last-searches"),y=s=>{if(i.classList.remove("active"),s.length){const e=l("visited");let n=0;s.map(o=>o.title).slice(0,10).forEach(o=>{const t=document.createElement("div");t.classList.add("suggest__item"),t.classList.add("suggest__item_anime"),t.textContent=o,e.find(r=>r.title===o)&&n<5?(n+=1,t.classList.add("suggest__item_visited"),i.prepend(t)):i.append(t)}),i.classList.add("active")}else{const e=document.createElement("div");e.classList.add("suggest__item"),e.textContent="There is no valid search results",i.append(e),i.classList.add("active")}},_=s=>{const e=document.querySelector(".output__header"),n=document.querySelector(".output__poster .poster-logo"),o=document.querySelector(".genres-text"),t=document.querySelector(".synopsys-text"),r=document.querySelector(".score-text"),c=document.querySelector(".url-text a");e.textContent=s.title,n.setAttribute("src",s.images.webp.image_url),o.textContent=s.genres.map(p=>p.name).join(", "),t.textContent=s.synopsis,r.textContent=`${s.score}`,c.setAttribute("href",s.url),L.classList.add("show")},g=()=>{d.innerHTML="";const s=document.createElement("h2");s.classList.add("last-searches__header"),s.textContent="Последние запросы:";const e=document.createElement("div");e.classList.add("last-searches__content"),d.append(s,e),l("visited").slice(0,3).forEach(o=>{const t=document.createElement("div");t.classList.add("last-searches__item"),t.textContent=o.title,e.append(t)}),d.classList.add("show")};let u;a.addEventListener("input",s=>{s.preventDefault(),a.value?(clearTimeout(u),u=setTimeout(async()=>{i.innerHTML="",i.classList.remove("active");let e=[];try{const n=await v(a.value);console.log(n),e=n.data,m("animes",e),y(e)}catch(n){console.log(n);const o=document.createElement("div");o.classList.add("suggest__item"),typeof n=="object"&&n!==null&&"status"in n&&"message"in n?o.textContent=`Error ${n.status}. 
            ${n.message}`:o.textContent=`${n}`,i.append(o),i.classList.add("active")}},300)):(i.innerHTML="",i.classList.remove("active"))});i.addEventListener("click",s=>{if(s.target instanceof HTMLDivElement&&s.target.classList.contains("suggest__item_anime")){a.value="",i.classList.remove("active");const e=s.target.textContent,n=h(e),o=l("visited");o.find(t=>t.title===e)||o.unshift(n),m("visited",o),_(n),g()}});window.addEventListener("storage",()=>{g()});

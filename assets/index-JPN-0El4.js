(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const u=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch{localStorage.clear()}},l=t=>{const e=localStorage.getItem(t);if(e!==null)try{return JSON.parse(e)}catch{return[]}return[]},p="https://api.jikan.moe/v4/anime",f=async t=>{try{const e=await fetch(`${p}?q=${t}`,{method:"GET",headers:{"Content-Type":"application/json"},redirect:"follow"});if(e.ok)return e.json();throw e}catch(e){throw console.log(e),e instanceof Response?{status:e.status,message:e.statusText}:e}},v=t=>l("animes").find(o=>o.title===t),h=(t,e)=>{let s;return function(...o){clearTimeout(s),s=setTimeout(()=>{t instanceof Function&&t(...o)},e)}},a=document.querySelector("#search__input"),i=document.querySelector(".suggest"),y=document.querySelector(".output"),d=document.querySelector(".last-searches"),L=t=>{if(i.classList.remove("active"),t.length){const e=l("visited");let s=0;t.map(o=>o.title).slice(0,10).forEach(o=>{const n=document.createElement("div");n.classList.add("suggest__item"),n.classList.add("suggest__item_anime"),n.textContent=o,e.find(r=>r.title===o)&&s<5?(s+=1,n.classList.add("suggest__item_visited"),i.prepend(n)):i.append(n)}),i.classList.add("active")}else{const e=document.createElement("div");e.classList.add("suggest__item"),e.textContent="There is no valid search results",i.append(e),i.classList.add("active")}},_=t=>{const e=document.querySelector(".output__header"),s=document.querySelector(".output__poster .poster-logo"),o=document.querySelector(".genres-text"),n=document.querySelector(".synopsys-text"),r=document.querySelector(".score-text"),c=document.querySelector(".url-text a");e.textContent=t.title,s.setAttribute("src",t.images.webp.image_url),o.textContent=t.genres.map(g=>g.name).join(", "),n.textContent=t.synopsis?t.synopsis:"Check MAL",r.textContent=t.score?`${t.score}`:"Not enough rates",c.setAttribute("href",t.url),y.classList.add("show")},m=()=>{d.innerHTML="";const t=document.createElement("h2");t.classList.add("last-searches__header"),t.textContent="Последние запросы:";const e=document.createElement("div");e.classList.add("last-searches__content"),d.append(t,e),l("visited").slice(0,3).forEach(o=>{const n=document.createElement("div");n.classList.add("last-searches__item"),n.textContent=o.title,e.append(n)}),d.classList.add("show")},S=async t=>{if(t.preventDefault(),a.value){i.innerHTML="",i.classList.remove("active");let e=[];try{const s=await f(a.value);console.log(s),e=s.data,u("animes",e),L(e)}catch(s){console.log(s);const o=document.createElement("div");o.classList.add("suggest__item"),typeof s=="object"&&s!==null&&"status"in s&&"message"in s?o.textContent=`Error ${s.status}. 
          ${s.message}`:o.textContent=`${s}`,i.append(o),i.classList.add("active")}}else i.innerHTML="",i.classList.remove("active")};a.addEventListener("input",h(S,1100));i.addEventListener("click",t=>{if(t.target instanceof HTMLDivElement&&t.target.classList.contains("suggest__item_anime")){a.value="",i.classList.remove("active");const e=t.target.textContent,s=v(e),o=l("visited");o.find(n=>n.title===e)||o.unshift(s),u("visited",o),_(s),m()}});window.addEventListener("storage",()=>{m()});
